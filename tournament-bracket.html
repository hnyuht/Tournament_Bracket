<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOURNAMENT SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF3B30;
            --secondary: #000000;
            --background: #F5F5F0;
            --surface: #FFFFFF;
            --text: #1A1A1A;
            --text-secondary: #666666;
            --border: #000000;
            --success: #00C853;
            --warning: #FFB300;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .header {
            background: var(--secondary);
            color: var(--surface);
            padding: 40px 20px;
            border-bottom: 8px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 59, 48, 0.1) 10px,
                rgba(255, 59, 48, 0.1) 20px
            );
            pointer-events: none;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-family: 'Archivo Black', sans-serif;
            font-size: clamp(2rem, 5vw, 4rem);
            letter-spacing: -2px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .subtitle {
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            opacity: 0.7;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .controls {
            background: var(--surface);
            border: 4px solid var(--border);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 12px 12px 0 rgba(0, 0, 0, 0.1);
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-family: 'Archivo Black', sans-serif;
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 10px;
            display: block;
        }

        .input-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        input[type="text"],
        input[type="number"],
        select {
            font-family: 'Roboto Mono', monospace;
            padding: 15px;
            border: 3px solid var(--border);
            background: var(--surface);
            font-size: 16px;
            flex: 1;
            min-width: 200px;
            transition: all 0.2s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        button {
            font-family: 'Roboto Mono', monospace;
            padding: 15px 30px;
            background: var(--border);
            color: var(--surface);
            border: none;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary);
            transition: left 0.3s;
            z-index: 0;
        }

        button:hover::before {
            left: 0;
        }

        button span {
            position: relative;
            z-index: 1;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(-1px);
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
        }

        button.btn-secondary {
            background: var(--surface);
            color: var(--border);
            border: 3px solid var(--border);
        }

        button.btn-primary {
            background: var(--primary);
        }

        button.btn-primary::before {
            background: var(--border);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1100px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--surface);
            border: 4px solid var(--border);
            box-shadow: 12px 12px 0 rgba(0, 0, 0, 0.1);
        }

        .panel-header {
            background: var(--border);
            color: var(--surface);
            padding: 20px;
            border-bottom: 4px solid var(--primary);
        }

        .panel-header h2 {
            font-family: 'Archivo Black', sans-serif;
            font-size: 20px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .panel-body {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .tabs {
            display: flex;
            border-bottom: 4px solid var(--border);
            background: var(--surface);
        }

        .tab {
            font-family: 'Roboto Mono', monospace;
            padding: 15px 25px;
            background: transparent;
            border: none;
            border-right: 3px solid var(--border);
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: var(--border);
            color: var(--surface);
        }

        .tab:hover:not(.active) {
            background: rgba(0, 0, 0, 0.05);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .round-selector {
            background: var(--surface);
            border: 4px solid var(--border);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 12px 12px 0 rgba(0, 0, 0, 0.1);
        }

        .round-info {
            background: var(--primary);
            color: var(--surface);
            padding: 20px;
            margin-bottom: 20px;
            border: 3px solid var(--border);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .player-card {
            background: var(--surface);
            border: 3px solid var(--border);
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            position: relative;
        }

        .player-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            background: var(--text-secondary);
        }

        .player-card.rank-1::before { background: #FFD700; }
        .player-card.rank-2::before { background: #C0C0C0; }
        .player-card.rank-3::before { background: #CD7F32; }
        .player-card.eliminated::before { background: #FF3B30; }

        .player-card:hover {
            transform: translateX(8px);
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.1);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .rank {
            font-family: 'Archivo Black', sans-serif;
            font-size: 32px;
            min-width: 60px;
            color: var(--text-secondary);
        }

        .player-name {
            font-weight: 700;
            font-size: 18px;
        }

        .player-stats {
            display: flex;
            gap: 25px;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .stat-value {
            font-family: 'Archivo Black', sans-serif;
            font-size: 24px;
        }

        .match-card {
            background: var(--surface);
            border: 3px solid var(--border);
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .match-card.completed {
            opacity: 0.6;
        }

        .match-card.bye {
            background: rgba(255, 187, 0, 0.1);
            border-color: var(--warning);
        }

        .table-badge {
            display: inline-block;
            background: var(--border);
            color: var(--surface);
            padding: 8px 16px;
            font-family: 'Archivo Black', sans-serif;
            font-size: 14px;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        .bye-badge {
            background: var(--warning);
            color: var(--secondary);
        }

        .match-players {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .match-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--border);
            background: var(--background);
        }

        .match-player.winner {
            background: rgba(0, 200, 83, 0.1);
            border-color: var(--success);
            border-width: 3px;
        }

        .match-player-name {
            font-weight: 700;
            flex: 1;
        }

        .match-record {
            margin: 0 20px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .win-btn {
            padding: 10px 20px;
            background: var(--success);
            color: var(--surface);
            border: 2px solid var(--border);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .win-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.2);
        }

        .win-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            background: var(--warning);
            color: var(--secondary);
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            margin-left: 10px;
        }

        .badge.complete {
            background: var(--success);
            color: var(--surface);
        }

        .badge.finals {
            background: #FFD700;
            color: var(--secondary);
        }

        .round-history-item {
            background: var(--surface);
            border: 3px solid var(--border);
            padding: 20px;
            margin-bottom: 15px;
        }

        .round-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .round-title {
            font-family: 'Archivo Black', sans-serif;
            font-size: 18px;
            text-transform: uppercase;
        }

        .round-stats {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .match-result {
            padding: 10px;
            border-left: 4px solid var(--primary);
            margin-bottom: 8px;
            background: var(--background);
            font-size: 14px;
        }

        .match-result strong {
            font-weight: 700;
            color: var(--success);
        }

        .bye-notice {
            padding: 15px;
            background: rgba(255, 187, 0, 0.2);
            border: 3px solid var(--warning);
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        .panel-body::-webkit-scrollbar {
            width: 12px;
        }

        .panel-body::-webkit-scrollbar-track {
            background: var(--background);
            border: 2px solid var(--border);
        }

        .panel-body::-webkit-scrollbar-thumb {
            background: var(--border);
            border: 2px solid var(--background);
        }

        .panel-body::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .player-card,
        .match-card {
            animation: slideIn 0.3s ease-out backwards;
        }

        .player-card:nth-child(1) { animation-delay: 0.05s; }
        .player-card:nth-child(2) { animation-delay: 0.1s; }
        .player-card:nth-child(3) { animation-delay: 0.15s; }
        .player-card:nth-child(4) { animation-delay: 0.2s; }
        .player-card:nth-child(5) { animation-delay: 0.25s; }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>TOURNAMENT SYSTEM</h1>
            <div class="subtitle">Elimination Tournament ‚Ä¢ Table Auto-Assignment</div>
        </div>
    </div>

    <div class="container">
        <div class="controls">
            <div class="control-group">
                <label class="control-label">Player Management</label>
                <div class="input-row">
                    <input type="text" id="playerName" placeholder="Enter player name...">
                    <button onclick="addPlayer()"><span>‚ûï Add Player</span></button>
                    <button class="btn-secondary" onclick="addMultiplePlayers()"><span>‚ûï Add Multiple</span></button>
                </div>
            </div>

            <div class="control-group" id="playerCountSection" style="display: none;">
                <div class="round-info" style="margin-bottom: 0;">
                    <span id="playerCount">0 PLAYERS REGISTERED</span>
                    <span id="roundCount"></span>
                </div>
            </div>

            <div class="control-group" id="tournamentTypeSection" style="display: none;">
                <label class="control-label">Tournament Type</label>
                <div class="input-row">
                    <select id="eliminationType" style="flex: 2;">
                        <option value="single">Single Elimination</option>
                        <option value="double">Double Elimination</option>
                    </select>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Tournament Control</label>
                <div class="input-row">
                    <input type="number" id="tableCount" value="200" min="1" max="200" placeholder="Available tables">
                    <button class="btn-primary" onclick="startNewRound()"><span>üé≤ Start New Round</span></button>
                    <button class="btn-secondary" onclick="resetTournament()"><span>üîÑ Reset All</span></button>
                </div>
            </div>
        </div>

        <div class="round-selector" id="roundSelector" style="display: none;">
            <label class="control-label">View Round</label>
            <select id="roundSelect" onchange="changeRound()">
                <option value="current">Current Round</option>
            </select>
        </div>

        <div class="grid">
            <div class="panel">
                <div class="panel-header">
                    <h2>üìä Standings</h2>
                </div>
                <div class="panel-body" id="standings">
                    <div class="empty-state">
                        <div class="empty-icon">üë•</div>
                        <p>NO PLAYERS REGISTERED</p>
                        <p style="font-size: 12px; margin-top: 10px;">Add players to begin tournament</p>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('matches')">ACTIVE MATCHES</button>
                    <button class="tab" onclick="switchTab('history')">MATCH HISTORY</button>
                </div>
                
                <div id="matchesTab" class="tab-content active">
                    <div class="panel-body" id="matches">
                        <div class="empty-state">
                            <div class="empty-icon">üéÆ</div>
                            <p>NO ACTIVE ROUND</p>
                            <p style="font-size: 12px; margin-top: 10px;">Start a round to generate pairings</p>
                        </div>
                    </div>
                </div>

                <div id="historyTab" class="tab-content">
                    <div class="panel-body" id="history">
                        <div class="empty-state">
                            <div class="empty-icon">üìú</div>
                            <p>NO HISTORY YET</p>
                            <p style="font-size: 12px; margin-top: 10px;">Complete matches to see history</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let players = [];
        let allRounds = [];
        let currentRoundIndex = -1;
        let eliminationType = 'single';

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'matches') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('matchesTab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('historyTab').classList.add('active');
                updateHistory();
            }
        }

        function updatePlayerCount() {
            const activePlayers = players.filter(p => !p.eliminated).length;
            const countSection = document.getElementById('playerCountSection');
            const typeSection = document.getElementById('tournamentTypeSection');
            
            if (activePlayers > 0) {
                countSection.style.display = 'block';
                typeSection.style.display = 'block';
                
                const countEl = document.getElementById('playerCount');
                const roundCountEl = document.getElementById('roundCount');
                
                countEl.textContent = `${activePlayers} PLAYERS REGISTERED`;
                
                const roundsNeeded = calculateRoundsNeeded(activePlayers);
                roundCountEl.textContent = `${roundsNeeded} ROUNDS TO TOP 8`;
            } else {
                countSection.style.display = 'none';
                typeSection.style.display = 'none';
            }
        }

        function calculateRoundsNeeded(playerCount) {
            let remaining = playerCount;
            let rounds = 0;
            
            while (remaining > 8) {
                remaining = Math.ceil(remaining / 2);
                rounds++;
            }
            
            return rounds;
        }

        function addPlayer() {
            const input = document.getElementById('playerName');
            const name = input.value.trim();
            
            if (!name) {
                alert('ENTER PLAYER NAME');
                return;
            }

            if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                alert('PLAYER ALREADY EXISTS');
                return;
            }

            players.push({
                id: Date.now(),
                name: name,
                wins: 0,
                losses: 0,
                opponentIds: [],
                eliminated: false
            });

            input.value = '';
            updatePlayerCount();
            updateStandings();
            saveData();
        }

        function addMultiplePlayers() {
            const count = prompt('NUMBER OF PLAYERS TO ADD:', '8');
            if (!count || isNaN(count) || count < 1) return;

            for (let i = 1; i <= parseInt(count); i++) {
                players.push({
                    id: Date.now() + i,
                    name: `PLAYER ${players.length + 1}`,
                    wins: 0,
                    losses: 0,
                    opponentIds: [],
                    eliminated: false
                });
            }

            updatePlayerCount();
            updateStandings();
            saveData();
        }

        function startNewRound() {
            const activePlayers = players.filter(p => !p.eliminated);
            
            if (activePlayers.length < 2) {
                alert('NEED AT LEAST 2 ACTIVE PLAYERS');
                return;
            }

            if (activePlayers.length <= 8 && allRounds.length > 0) {
                if (!confirm('You have reached TOP 8! Start finals round?')) {
                    return;
                }
            }

            if (currentRoundIndex >= 0) {
                const currentRound = allRounds[currentRoundIndex];
                const incomplete = currentRound.matches.filter(m => !m.complete && !m.isBye).length;
                if (incomplete > 0) {
                    if (!confirm(`${incomplete} matches incomplete. Start new round anyway?`)) {
                        return;
                    }
                }
            }

            eliminationType = document.getElementById('eliminationType').value;
            const tableCount = parseInt(document.getElementById('tableCount').value);
            
            const sortedPlayers = [...activePlayers].sort((a, b) => {
                if (b.wins !== a.wins) return b.wins - a.wins;
                return a.losses - b.losses;
            });

            const matches = [];
            let tableNumber = 1;
            const paired = new Set();
            let byePlayer = null;

            if (sortedPlayers.length % 2 === 1) {
                for (let i = sortedPlayers.length - 1; i >= 0; i--) {
                    const player = sortedPlayers[i];
                    const hadBye = allRounds.some(r => 
                        r.matches.some(m => m.isBye && (m.player1Id === player.id))
                    );
                    if (!hadBye) {
                        byePlayer = player;
                        break;
                    }
                }
                if (!byePlayer) {
                    byePlayer = sortedPlayers[sortedPlayers.length - 1];
                }
            }

            if (byePlayer) {
                matches.push({
                    id: Date.now(),
                    table: 0,
                    player1Id: byePlayer.id,
                    player2Id: null,
                    complete: true,
                    winnerId: byePlayer.id,
                    isBye: true
                });
                paired.add(byePlayer.id);
            }

            for (let i = 0; i < sortedPlayers.length; i++) {
                if (paired.has(sortedPlayers[i].id)) continue;
                if (tableNumber > tableCount) break;

                let opponent = null;
                for (let j = i + 1; j < sortedPlayers.length; j++) {
                    if (paired.has(sortedPlayers[j].id)) continue;
                    
                    const hasPlayed = sortedPlayers[i].opponentIds.includes(sortedPlayers[j].id);
                    if (!hasPlayed) {
                        opponent = sortedPlayers[j];
                        break;
                    }
                }

                if (!opponent) {
                    for (let j = i + 1; j < sortedPlayers.length; j++) {
                        if (paired.has(sortedPlayers[j].id)) continue;
                        opponent = sortedPlayers[j];
                        break;
                    }
                }

                if (opponent) {
                    matches.push({
                        id: Date.now() + tableNumber,
                        table: tableNumber,
                        player1Id: sortedPlayers[i].id,
                        player2Id: opponent.id,
                        complete: false,
                        winnerId: null,
                        isBye: false
                    });
                    paired.add(sortedPlayers[i].id);
                    paired.add(opponent.id);
                    tableNumber++;
                }
            }

            const isFinals = activePlayers.length <= 8;

            const newRound = {
                roundNumber: allRounds.length + 1,
                matches: matches,
                timestamp: new Date().toISOString(),
                eliminationType: eliminationType,
                isFinals: isFinals
            };

            allRounds.push(newRound);
            currentRoundIndex = allRounds.length - 1;

            updateRoundSelector();
            updateMatches();
            updateStandings();
            saveData();
        }

        function changeRound() {
            const select = document.getElementById('roundSelect');
            if (select.value === 'current') {
                currentRoundIndex = allRounds.length - 1;
            } else {
                currentRoundIndex = parseInt(select.value);
            }
            updateMatches();
        }

        function updateRoundSelector() {
            const selector = document.getElementById('roundSelector');
            const select = document.getElementById('roundSelect');
            
            if (allRounds.length === 0) {
                selector.style.display = 'none';
                return;
            }

            selector.style.display = 'block';
            
            select.innerHTML = '<option value="current">Current Round</option>';
            allRounds.forEach((round, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `Round ${round.roundNumber}${round.isFinals ? ' (FINALS)' : ''}`;
                if (index === currentRoundIndex) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        function recordWin(matchId, winnerId) {
            if (currentRoundIndex < 0) return;
            
            const round = allRounds[currentRoundIndex];
            const match = round.matches.find(m => m.id === matchId);
            if (!match || match.complete || match.isBye) return;

            const loserId = winnerId === match.player1Id ? match.player2Id : match.player1Id;
            
            const winner = players.find(p => p.id === winnerId);
            const loser = players.find(p => p.id === loserId);

            winner.wins++;
            loser.losses++;
            winner.opponentIds.push(loserId);
            loser.opponentIds.push(winnerId);

            if (round.eliminationType === 'single') {
                loser.eliminated = true;
            } else if (round.eliminationType === 'double') {
                if (loser.losses >= 2) {
                    loser.eliminated = true;
                }
            }

            match.complete = true;
            match.winnerId = winnerId;

            updatePlayerCount();
            updateMatches();
            updateStandings();
            saveData();
        }

        function updateStandings() {
            const standings = document.getElementById('standings');
            
            if (players.length === 0) {
                standings.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üë•</div>
                        <p>NO PLAYERS REGISTERED</p>
                        <p style="font-size: 12px; margin-top: 10px;">Add players to begin tournament</p>
                    </div>
                `;
                return;
            }

            const sorted = [...players].sort((a, b) => {
                if (a.eliminated !== b.eliminated) return a.eliminated ? 1 : -1;
                if (b.wins !== a.wins) return b.wins - a.wins;
                if (a.losses !== b.losses) return a.losses - b.losses;
                return a.name.localeCompare(b.name);
            });

            standings.innerHTML = sorted.map((player, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : '';
                const eliminatedClass = player.eliminated ? 'eliminated' : '';
                const total = player.wins + player.losses;
                const winRate = total > 0 ? Math.round((player.wins / total) * 100) : 0;

                return `
                    <div class="player-card ${rankClass} ${eliminatedClass}">
                        <div class="player-info">
                            <div class="rank">#${rank}</div>
                            <div class="player-name">${player.name}${player.eliminated ? ' ‚ùå' : ''}</div>
                        </div>
                        <div class="player-stats">
                            <div class="stat">
                                <div class="stat-label">Wins</div>
                                <div class="stat-value">${player.wins}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Loss</div>
                                <div class="stat-value">${player.losses}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Rate</div>
                                <div class="stat-value">${winRate}%</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMatches() {
            const matchesDiv = document.getElementById('matches');
            
            if (currentRoundIndex < 0 || allRounds.length === 0) {
                matchesDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üéÆ</div>
                        <p>NO ACTIVE ROUND</p>
                        <p style="font-size: 12px; margin-top: 10px;">Start a round to generate pairings</p>
                    </div>
                `;
                return;
            }

            const round = allRounds[currentRoundIndex];
            const completed = round.matches.filter(m => m.complete).length;
            const total = round.matches.length;
            const isCurrentRound = currentRoundIndex === allRounds.length - 1;
            const hasBye = round.matches.some(m => m.isBye);

            let html = `
                <div class="round-info">
                    <span>ROUND ${round.roundNumber} ‚Ä¢ ${round.eliminationType.toUpperCase()} ELIM ‚Ä¢ ${completed}/${total} COMPLETE</span>
                    <span class="badge ${completed === total ? 'complete' : ''} ${round.isFinals ? 'finals' : ''}">${round.isFinals ? 'FINALS' : (completed === total ? 'COMPLETE' : 'IN PROGRESS')}</span>
                </div>
            `;

            if (hasBye) {
                const byeMatch = round.matches.find(m => m.isBye);
                const byePlayer = players.find(p => p.id === byeMatch.player1Id);
                html += `
                    <div class="bye-notice">
                        ‚ö†Ô∏è ${byePlayer.name} receives a BYE (odd number of players) - automatically advances!
                    </div>
                `;
            }

            html += round.matches.filter(m => !m.isBye).map(match => {
                const p1 = players.find(p => p.id === match.player1Id);
                const p2 = players.find(p => p.id === match.player2Id);
                
                return `
                    <div class="match-card ${match.complete ? 'completed' : ''}">
                        <div class="table-badge">TABLE ${match.table}</div>
                        <div class="match-players">
                            <div class="match-player ${match.winnerId === p1.id ? 'winner' : ''}">
                                <span class="match-player-name">${p1.name}</span>
                                <span class="match-record">${p1.wins}-${p1.losses}</span>
                                <button class="win-btn" 
                                        onclick="recordWin(${match.id}, ${p1.id})"
                                        ${match.complete || !isCurrentRound ? 'disabled' : ''}>
                                    ${match.winnerId === p1.id ? '‚úì WINNER' : 'RECORD WIN'}
                                </button>
                            </div>
                            <div class="match-player ${match.winnerId === p2.id ? 'winner' : ''}">
                                <span class="match-player-name">${p2.name}</span>
                                <span class="match-record">${p2.wins}-${p2.losses}</span>
                                <button class="win-btn" 
                                        onclick="recordWin(${match.id}, ${p2.id})"
                                        ${match.complete || !isCurrentRound ? 'disabled' : ''}>
                                    ${match.winnerId === p2.id ? '‚úì WINNER' : 'RECORD WIN'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            matchesDiv.innerHTML = html;
        }

        function updateHistory() {
            const historyDiv = document.getElementById('history');
            
            if (allRounds.length === 0) {
                historyDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìú</div>
                        <p>NO HISTORY YET</p>
                        <p style="font-size: 12px; margin-top: 10px;">Complete matches to see history</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            [...allRounds].reverse().forEach(round => {
                const completedMatches = round.matches.filter(m => m.complete);
                
                html += `
                    <div class="round-history-item">
                        <div class="round-history-header">
                            <div class="round-title">Round ${round.roundNumber}${round.isFinals ? ' (FINALS)' : ''}</div>
                            <div class="round-stats">${completedMatches.length}/${round.matches.length} matches ‚Ä¢ ${round.eliminationType.toUpperCase()} ELIM</div>
                        </div>
                `;

                completedMatches.forEach(match => {
                    if (match.isBye) {
                        const player = players.find(p => p.id === match.player1Id);
                        html += `
                            <div class="match-result" style="border-left-color: var(--warning);">
                                BYE: <strong>${player.name}</strong> advances automatically
                            </div>
                        `;
                    } else {
                        const winner = players.find(p => p.id === match.winnerId);
                        const loser = players.find(p => p.id === (match.winnerId === match.player1Id ? match.player2Id : match.player1Id));
                        
                        html += `
                            <div class="match-result">
                                Table ${match.table}: <strong>${winner.name}</strong> defeated ${loser.name}
                            </div>
                        `;
                    }
                });

                html += `</div>`;
            });

            historyDiv.innerHTML = html;
        }

        function resetTournament() {
            if (!confirm('RESET TOURNAMENT? This will keep players but clear all rounds and records.')) {
                return;
            }

            players.forEach(player => {
                player.wins = 0;
                player.losses = 0;
                player.opponentIds = [];
                player.eliminated = false;
            });

            allRounds = [];
            currentRoundIndex = -1;

            updateRoundSelector();
            updatePlayerCount();
            updateStandings();
            updateMatches();
            updateHistory();
            saveData();
        }

        function saveData() {
            localStorage.setItem('tournamentData', JSON.stringify({
                players: players,
                allRounds: allRounds,
                currentRoundIndex: currentRoundIndex
            }));
        }

        function loadData() {
            const saved = localStorage.getItem('tournamentData');
            if (saved) {
                const data = JSON.parse(saved);
                players = data.players || [];
                allRounds = data.allRounds || [];
                currentRoundIndex = data.currentRoundIndex ?? -1;
                
                updateRoundSelector();
                updatePlayerCount();
                updateStandings();
                updateMatches();
            }
        }

        loadData();
        
        document.getElementById('playerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addPlayer();
        });
    </script>
</body>
</html>
